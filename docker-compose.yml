services:
  pihole:
    container_name: pihole
    image: pihole/pihole:2025.03.0
    hostname: ${HOSTNAME}
    domainname: ${DOMAIN_NAME}
    ports:
      - 53:53/tcp
      - 53:53/udp
      - "8080:80/tcp"
    environment:
      - TZ=America/Los_Angeles
      - WEBPASSWORD_FILE=pihole_webpw
      - FTLCONF_webserver_interface_theme=default-auto
      - FTLCONF_dns_upstreams=1.1.1.1
      # - FTLCONF_dns_revServers=true,192.168.50.0/24,192.168.50.1:53,local
      - FTLCONF_BLOCK_ICLOUD_PR=false
      - FTLCONF_dns_listeningMode=all
    volumes:
      # For persisting Pi-hole's databases and common configuration file
      - etc_pihole:/etc/pihole
    cap_add:
      # See https://github.com/pi-hole/docker-pi-hole#note-on-capabilities
      # Required if you are using Pi-hole as your DHCP server, else not needed
      - NET_ADMIN
      # Required if you are using Pi-hole as your NTP client to be able to set the host's system time
      - SYS_TIME
      # Optional, if Pi-hole should get some more processing time
      - SYS_NICE
    secrets:
      - pihole_webpw
    dns:
      - 1.1.1.1
    restart: unless-stopped

  unbound:
    container_name: unbound
    image: mvance/unbound${UNBOUND_IMAGE_SUFFIX}:1.22.0
    ports:
      - "5335:5335/tcp"
      - "5335:5335/udp"
    volumes:
      - ./unbound-conf:/opt/unbound/etc/unbound
    restart: unless-stopped

secrets:
  pihole_webpw:
    file: webpassword

volumes:
  etc_pihole:
